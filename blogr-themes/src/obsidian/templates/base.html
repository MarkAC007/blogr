<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{% block title %}{{ site.blog.title }}{% endblock %}</title>

        <!-- Favicon -->
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>"
        />

        {% block meta %}
        <meta name="description" content="{{ site.blog.description }}" />
        <meta name="author" content="{{ site.blog.author }}" />
        {% endblock %}

        <!-- Comprehensive fallback Obsidian-compatible styles -->
        <style>
            /* CSS Custom Properties for Obsidian theming */
            :root {
                --background-primary: #ffffff;
                --background-secondary: #f2f3f5;
                --background-modifier-border: #e9ecef;
                --text-normal: #2e3338;
                --text-muted: #7c7c7c;
                --text-faint: #999999;
                --text-accent: #7c3aed;
                --text-accent-hover: #5b21b6;
                --interactive-accent: #7c3aed;
                --interactive-accent-hover: #5b21b6;
                --background-modifier-hover: #f8f9fa;
                --background-modifier-active: #e9ecef;
                --tag-background: #e9ecef;
                --tag-color: #6b7280;
                --callout-info: #2196f3;
                --callout-tip: #4caf50;
                --callout-warning: #ff9800;
                --callout-error: #f44336;
                --callout-abstract: #00bcd4;
                --callout-note: #ff9800;
            }

            .theme-dark {
                --background-primary: #202020;
                --background-secondary: #161616;
                --background-modifier-border: #2a2a2a;
                --text-normal: #dcddde;
                --text-muted: #999999;
                --text-faint: #666666;
                --text-accent: #a78bfa;
                --text-accent-hover: #c4b5fd;
                --interactive-accent: #a78bfa;
                --interactive-accent-hover: #c4b5fd;
                --background-modifier-hover: #2a2a2a;
                --background-modifier-active: #333333;
                --tag-background: #2a2a2a;
                --tag-color: #999999;
            }

            .theme-light {
                --background-primary: #ffffff;
                --background-secondary: #f2f3f5;
                --background-modifier-border: #e9ecef;
                --text-normal: #2e3338;
                --text-muted: #7c7c7c;
                --text-faint: #999999;
            }

            /* Base Obsidian structure */
            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, Cantarell, sans-serif;
                background-color: var(--background-primary);
                color: var(--text-normal);
                margin: 0;
                padding: 0;
                line-height: 1.6;
            }

            .app-container {
                min-height: 100vh;
                background-color: var(--background-primary);
            }

            .workspace {
                display: flex;
                width: 100%;
                min-height: 100vh;
            }

            .workspace-leaf-content {
                flex: 1;
                background-color: var(--background-primary);
                display: flex;
                justify-content: center;
                width: 100%;
            }

            .markdown-preview-view {
                padding: 0;
                background-color: var(--background-primary);
                width: 100%;
                max-width: 100%;
                display: flex;
                justify-content: center;
            }

            .markdown-rendered {
                max-width: 900px;
                margin: 0 auto;
                padding: 40px 20px;
                font-size: 16px;
                line-height: 1.6;
                color: var(--text-normal);
                width: 100%;
                box-sizing: border-box;
            }

            /* Typography */
            .inline-title {
                font-size: 2.25em;
                font-weight: 700;
                margin-bottom: 0.5em;
                color: var(--text-normal);
                border: none;
                background: transparent;
                display: block;
                line-height: 1.2;
            }

            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                color: var(--text-normal);
                font-weight: 600;
                margin-top: 1.5em;
                margin-bottom: 0.5em;
                line-height: 1.3;
            }

            h1 {
                font-size: 2em;
            }
            h2 {
                font-size: 1.5em;
            }
            h3 {
                font-size: 1.25em;
            }
            h4 {
                font-size: 1.125em;
            }
            h5 {
                font-size: 1em;
            }
            h6 {
                font-size: 0.875em;
            }

            /* Links */
            a {
                color: var(--text-accent);
                text-decoration: none;
            }

            a:hover {
                color: var(--text-accent-hover);
                text-decoration: underline;
            }

            .internal-link {
                color: var(--text-accent);
                text-decoration: none;
            }

            .internal-link:hover {
                color: var(--text-accent-hover);
                text-decoration: underline;
            }

            /* Callouts */
            .callout {
                padding: 16px;
                margin: 16px 0;
                border-radius: 8px;
                border-left: 4px solid var(--interactive-accent);
                background-color: var(--background-secondary);
                position: relative;
            }

            .callout[data-callout="info"] {
                border-left-color: var(--callout-info);
            }

            .callout[data-callout="tip"] {
                border-left-color: var(--callout-tip);
            }

            .callout[data-callout="warning"] {
                border-left-color: var(--callout-warning);
            }

            .callout[data-callout="error"] {
                border-left-color: var(--callout-error);
            }

            .callout[data-callout="abstract"] {
                border-left-color: var(--callout-abstract);
            }

            .callout[data-callout="note"] {
                border-left-color: var(--callout-note);
            }

            .callout-title {
                font-weight: 600;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .callout-content {
                margin: 0;
            }

            /* Tags */
            .tag {
                background-color: var(--tag-background);
                color: var(--tag-color);
                padding: 4px 8px;
                border-radius: 12px;
                text-decoration: none;
                font-size: 0.85em;
                margin-right: 8px;
                margin-bottom: 4px;
                display: inline-block;
                border: 1px solid var(--background-modifier-border);
                transition: all 0.2s ease;
            }

            .tag:hover {
                background-color: var(--interactive-accent);
                color: white;
                border-color: var(--interactive-accent);
            }

            .tag-container {
                margin: 16px 0;
            }

            /* Embedded content */
            .markdown-embed {
                border: 1px solid var(--background-modifier-border);
                border-radius: 8px;
                margin: 16px 0;
                padding: 16px;
                background-color: var(--background-secondary);
            }

            .markdown-embed-title {
                font-weight: 600;
                margin-bottom: 8px;
                font-size: 1.1em;
            }

            .markdown-embed-link {
                color: var(--text-accent);
                text-decoration: none;
            }

            .markdown-embed-link:hover {
                color: var(--text-accent-hover);
                text-decoration: underline;
            }

            /* Navigation elements */
            .nav-folder-children {
                margin: 16px 0;
            }

            .nav-file {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid var(--background-modifier-border);
            }

            .nav-file:last-child {
                border-bottom: none;
            }

            .nav-file-title {
                flex: 1;
            }

            .nav-file-title-content {
                color: var(--text-normal);
            }

            .nav-file-tag {
                margin-left: 12px;
            }

            /* Code */
            code {
                background-color: var(--background-secondary);
                padding: 2px 4px;
                border-radius: 4px;
                font-family: "SF Mono", Monaco, "Roboto Mono", monospace;
                font-size: 0.9em;
                color: var(--text-normal);
            }

            pre {
                background-color: var(--background-secondary);
                padding: 16px;
                border-radius: 8px;
                overflow-x: auto;
                border: 1px solid var(--background-modifier-border);
            }

            pre code {
                background: none;
                padding: 0;
            }

            /* Blockquotes */
            blockquote {
                border-left: 4px solid var(--text-accent);
                padding-left: 16px;
                margin: 16px 0;
                font-style: italic;
                color: var(--text-muted);
                background-color: var(--background-secondary);
                padding: 16px;
                border-radius: 0 8px 8px 0;
            }

            /* Lists */
            ul,
            ol {
                padding-left: 24px;
            }

            li {
                margin: 4px 0;
            }

            /* Tables */
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 16px 0;
            }

            th,
            td {
                border: 1px solid var(--background-modifier-border);
                padding: 8px 12px;
                text-align: left;
            }

            th {
                background-color: var(--background-secondary);
                font-weight: 600;
            }

            /* Search Styles */
            .search-form {
                position: relative;
                margin: 0;
            }

            .search-container {
                display: flex;
                align-items: center;
                background: var(--background-secondary);
                border: 1px solid var(--background-modifier-border);
                border-radius: 6px;
                padding: 8px 12px;
                transition: all 0.2s ease;
                max-width: 400px;
            }

            .search-container:focus-within {
                border-color: var(--interactive-accent);
                box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.1);
            }

            #search-input {
                flex: 1;
                border: none;
                background: transparent;
                padding: 4px 8px;
                font-family: inherit;
                font-size: 14px;
                color: var(--text-normal);
                outline: none;
            }

            #search-input::placeholder {
                color: var(--text-muted);
            }

            .search-button {
                background: none;
                border: none;
                padding: 4px;
                cursor: pointer;
                color: var(--text-muted);
                transition: color 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .search-button:hover {
                color: var(--interactive-accent);
            }

            .search-results {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--background-primary);
                border: 1px solid var(--background-modifier-border);
                border-top: none;
                border-radius: 0 0 6px 6px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                max-height: 400px;
                overflow-y: auto;
                z-index: 1000;
                margin-top: -1px;
            }

            .search-results-visible {
                display: block !important;
            }

            .search-result-item {
                padding: 12px;
                border-bottom: 1px solid var(--background-modifier-border);
                transition: background-color 0.2s ease;
            }

            .search-result-item:last-child {
                border-bottom: none;
            }

            .search-result-item:hover {
                background-color: var(--background-modifier-hover);
            }

            .search-result-item.is-active {
                background-color: var(--background-modifier-hover);
                outline: 2px solid var(--interactive-accent);
            }

            .search-result-title {
                margin: 0 0 6px 0;
                font-size: 16px;
                font-weight: 600;
                color: var(--text-normal);
            }

            .search-result-link {
                color: var(--text-normal);
                text-decoration: none;
                transition: color 0.2s ease;
            }

            .search-result-link:hover {
                color: var(--interactive-accent);
            }

            .search-result-meta {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 6px;
                font-size: 12px;
                color: var(--text-muted);
            }

            .search-result-tags {
                display: flex;
                gap: 4px;
                flex-wrap: wrap;
            }

            .search-tag {
                background: var(--tag-background);
                color: var(--tag-color);
                padding: 2px 6px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: 500;
            }

            .search-result-excerpt {
                margin: 0;
                font-size: 14px;
                color: var(--text-muted);
                line-height: 1.4;
            }

            .search-highlight {
                background: var(--tag-background);
                color: var(--tag-color);
                padding: 1px 3px;
                border-radius: 3px;
                font-weight: 600;
            }

            .search-result-actions {
                display: flex;
                gap: 8px;
                margin-top: 8px;
            }

            .search-action {
                background: var(--background-secondary);
                color: var(--text-muted);
                border: 1px solid var(--background-modifier-border);
                border-radius: 4px;
                padding: 4px 8px;
                font-size: 12px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .search-action:hover {
                color: var(--interactive-accent);
                border-color: var(--interactive-accent);
            }

            .search-results-footer {
                padding: 8px 12px;
                display: flex;
                justify-content: center;
                background: var(--background-primary);
            }

            .search-results-more {
                background: var(--interactive-accent);
                color: #fff;
                border: none;
                border-radius: 16px;
                padding: 6px 12px;
                font-size: 12px;
                cursor: pointer;
                transition: background-color 0.2s ease;
            }

            .search-results-more:hover {
                background: var(--interactive-accent-hover);
            }

            .search-no-results,
            .search-error {
                padding: 16px;
                text-align: center;
                color: var(--text-muted);
            }

            .search-suggestions {
                font-size: 14px;
                margin-top: 6px;
            }

            /* Responsive design */
            @media (max-width: 1200px) {
                .markdown-rendered {
                    max-width: 800px;
                    padding: 40px 24px;
                }
            }

            @media (max-width: 768px) {
                .markdown-rendered {
                    max-width: 100%;
                    padding: 20px 16px;
                }

                .inline-title {
                    font-size: 1.8em;
                }

                .search-container {
                    max-width: 100%;
                }
                
                .search-results {
                    left: 0;
                    right: 0;
                }
            }
        </style>

        <!-- Load bundled default Obsidian CSS -->
        <link rel="stylesheet" href="{{ url(path='css/obsidian-default.css') | safe }}" />

        <!-- Load user-supplied Obsidian CSS with error handling -->
        <link
            rel="stylesheet"
            href="{{ url(path=site.theme.config.obsidian_css | default(value='static/obsidian.css')) | safe }}"
            onerror="this.onerror=null;console.warn('Custom Obsidian CSS not found - using default styles. You can add a custom Obsidian theme by saving it as static/obsidian.css in your blog directory.');"
            onload="console.log('Custom Obsidian CSS loaded successfully');"
        />

        <meta name="blogr-base" content="{{ url(path='') | safe }}" />
        {% block extra_head %}{% endblock %}

        <script>
            // Wait for DOM to be ready
            document.addEventListener("DOMContentLoaded", function () {
                var mode =
                    "{{ site.theme.config.color_mode | default(value='auto') }}";
                var isDark =
                    window.matchMedia &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches;
                var body = document.body;

                if (body) {
                    if (mode === "auto") {
                        body.classList.toggle("theme-dark", isDark);
                        body.classList.toggle("theme-light", !isDark);
                    } else {
                        body.classList.add(
                            mode === "dark" ? "theme-dark" : "theme-light",
                        );
                    }

                    // Add Obsidian workspace classes
                    body.classList.add(
                        "mod-macos",
                        "is-frameless",
                        "is-hidden-frameless",
                    );

                    // Listen for system theme changes
                    if (mode === "auto" && window.matchMedia) {
                        window
                            .matchMedia("(prefers-color-scheme: dark)")
                            .addEventListener("change", function (e) {
                                body.classList.toggle("theme-dark", e.matches);
                                body.classList.toggle(
                                    "theme-light",
                                    !e.matches,
                                );
                            });
                    }
                }
            });
        </script>
    </head>
    <body class="workspace-leaf-content">
        <div class="app-container">
            <div class="workspace">
                <div class="workspace-split mod-vertical mod-root">
                    <div class="workspace-leaf mod-active">
                        <div class="workspace-leaf-content">
                            <!-- Search bar -->
                            <div class="search-bar-container" style="padding: 16px; border-bottom: 1px solid var(--background-modifier-border);">
                                <form id="search-form" class="search-form" role="search">
                                    <div class="search-container">
                                        <input 
                                            id="search-input" 
                                            name="q" 
                                            type="search" 
                                            placeholder="Search posts..." 
                                            autocomplete="off"
                                            aria-label="Search posts"
                                        />
                                        <button type="submit" class="search-button" aria-label="Search">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="11" cy="11" r="8"></circle>
                                                <path d="m21 21-4.35-4.35"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div id="search-results" class="search-results" hidden></div>
                                </form>
                            </div>
                            
                            <div class="view-content" style="width: 100%; display: flex; justify-content: center;">
                                <div class="markdown-reading-view" style="width: 100%; display: flex; justify-content: center;">
                                    <div
                                        class="markdown-preview-view markdown-rendered"
                                    >
                                        <div class="markdown-preview-section">
                                            {% block content %}{% endblock %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Search functionality -->
        <script src="{{ url(path='js/vendor/minisearch.min.js') | safe }}"></script>
        <script src="{{ url(path='js/search.js') | safe }}"></script>
        
        {% block extra_scripts %}{% endblock %}
    </body>
</html>
