{% extends "base.html" %}

{% block title %}{{ site.blog.title }}{% endblock %}

{% block content %}
<div class="posts-container">
    {% if posts %}
        {% for post in posts %}
        <article class="post-entry" data-post-id="{{ loop.index }}">
            <!-- Post Header -->
            <header class="post-entry-header" onclick="togglePost({{ loop.index }})">
                <h2 class="post-entry-title">{{ post.metadata.title }}</h2>
                
                <div class="post-entry-meta">
                    <time class="post-date">{{ post.metadata.date | date(format="%b %d, %Y") }}</time>
                    
                    {% if post.metadata.author %}
                    <span class="post-author">{{ post.metadata.author }}</span>
                    {% endif %}
                    
                    {% if post.reading_time %}
                    <span class="reading-time">{{ post.reading_time }}min</span>
                    {% endif %}
                </div>

                <!-- Tags as artistic elements -->
                {% if post.metadata.tags %}
                <div class="post-tags-preview">
                    {% for tag in post.metadata.tags %}
                    <span class="tag-bubble">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Expand indicator -->
                <div class="expand-indicator">
                    <span class="expand-text">read</span>
                    <span class="expand-arrow">↓</span>
                </div>
            </header>

            <!-- Expandable Content -->
            <div class="post-entry-content" id="post-content-{{ loop.index }}">
                {% if post.metadata.description %}
                <div class="post-description">
                    {{ post.metadata.description }}
                </div>
                {% endif %}
                
                <div class="post-full-content">
                    {{ post.content | safe }}
                </div>

                <!-- Post Footer with full tags -->
                <footer class="post-entry-footer">
                    {% if post.metadata.tags %}
                    <div class="post-tags-full">
                        <span class="tags-label">tagged:</span>
                        {% for tag in post.metadata.tags %}
                        <a href="/tags/{{ tag }}.html" class="tag-link">{{ tag }}</a>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="post-actions">
                        <a href="/posts/{{ post.metadata.slug }}.html" class="permalink">permalink</a>
                        <button class="collapse-btn" onclick="togglePost({{ loop.index }})">collapse</button>
                    </div>
                </footer>
            </div>
        </article>
        {% endfor %}
    {% else %}
    <div class="empty-state">
        <h2>No posts yet</h2>
        <p>This space is waiting for stories to fill it.</p>
    </div>
    {% endif %}
</div>

<script>
function togglePost(postId) {
    const content = document.getElementById('post-content-' + postId);
    const article = document.querySelector('[data-post-id="' + postId + '"]');
    const arrow = article.querySelector('.expand-arrow');
    const text = article.querySelector('.expand-text');
    
    if (content.classList.contains('expanded')) {
        content.classList.remove('expanded');
        article.classList.remove('expanded');
        arrow.textContent = '↓';
        text.textContent = 'read';
    } else {
        // Close other expanded posts
        document.querySelectorAll('.post-entry-content.expanded').forEach(el => {
            el.classList.remove('expanded');
        });
        document.querySelectorAll('.post-entry.expanded').forEach(el => {
            el.classList.remove('expanded');
            el.querySelector('.expand-arrow').textContent = '↓';
            el.querySelector('.expand-text').textContent = 'read';
        });
        
        // Open this post
        content.classList.add('expanded');
        article.classList.add('expanded');
        arrow.textContent = '↑';
        text.textContent = 'close';
        
        // Smooth scroll to post
        article.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// Close expanded posts when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.post-entry')) {
        document.querySelectorAll('.post-entry-content.expanded').forEach(el => {
            el.classList.remove('expanded');
        });
        document.querySelectorAll('.post-entry.expanded').forEach(el => {
            el.classList.remove('expanded');
            el.querySelector('.expand-arrow').textContent = '↓';
            el.querySelector('.expand-text').textContent = 'read';
        });
    }
});
</script>
{% endblock %}