{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ config.blog.title }}{% endblock %}

{% block meta %}
<meta name="description" content="{{ post.description | default(value=post.title) }}">
<meta name="author" content="{{ post.author | default(value=config.blog.author) }}">
<meta property="og:title" content="{{ post.title }}">
<meta property="og:description" content="{{ post.description | default(value='') }}">
<meta property="og:type" content="article">
<meta property="og:url" content="{{ config.blog.base_url }}/posts/{{ post.slug }}">
<meta property="article:published_time" content="{{ post.date }}">
<meta property="article:author" content="{{ post.author | default(value=config.blog.author) }}">
{% if post.tags %}
{% for tag in post.tags %}
<meta property="article:tag" content="{{ tag }}">
{% endfor %}
{% endif %}
{% endblock %}

{% block content %}
<article class="post-article">
    <header class="post-header">
        <h1 class="post-title">{{ post.title }}</h1>

        <div class="post-meta">
            <div class="meta-left">
                <time class="post-date" datetime="{{ post.date }}">
                    {{ post.date | date(format="%B %d, %Y") }}
                </time>

                {% if config.theme.config.show_author and post.author %}
                <span class="post-author">by {{ post.author }}</span>
                {% endif %}
            </div>

            <div class="meta-right">
                {% if config.theme.config.show_reading_time and post.reading_time %}
                <span class="reading-time">{{ post.reading_time }} min read</span>
                {% endif %}

                {% if post.status == "draft" %}
                <span class="draft-badge">Draft</span>
                {% endif %}
            </div>
        </div>

        {% if post.description %}
        <div class="post-description">
            <p>{{ post.description }}</p>
        </div>
        {% endif %}

        {% if post.tags %}
        <div class="post-tags">
            {% for tag in post.tags %}
            <a href="/tags/{{ tag | slugify }}" class="tag">#{{ tag }}</a>
            {% endfor %}
        </div>
        {% endif %}
    </header>

    <div class="post-content">
        {{ post.content | safe }}
    </div>

    <footer class="post-footer">
        <div class="post-navigation">
            {% if prev_post %}
            <div class="nav-prev">
                <a href="/posts/{{ prev_post.slug }}" class="nav-link">
                    <span class="nav-label">← Previous</span>
                    <span class="nav-title">{{ prev_post.title }}</span>
                </a>
            </div>
            {% endif %}

            {% if next_post %}
            <div class="nav-next">
                <a href="/posts/{{ next_post.slug }}" class="nav-link">
                    <span class="nav-label">Next →</span>
                    <span class="nav-title">{{ next_post.title }}</span>
                </a>
            </div>
            {% endif %}
        </div>

        <div class="post-share">
            <p class="share-text">Share this post:</p>
            <div class="share-links">
                <a href="https://twitter.com/intent/tweet?text={{ post.title | urlencode }}&url={{ config.blog.base_url }}/posts/{{ post.slug }}"
                   target="_blank" rel="noopener" class="share-link twitter">
                    Twitter
                </a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ config.blog.base_url }}/posts/{{ post.slug }}"
                   target="_blank" rel="noopener" class="share-link linkedin">
                    LinkedIn
                </a>
                <a href="mailto:?subject={{ post.title | urlencode }}&body=Check out this post: {{ config.blog.base_url }}/posts/{{ post.slug }}"
                   class="share-link email">
                    Email
                </a>
            </div>
        </div>
    </footer>
</article>

<aside class="related-posts">
    {% if related_posts %}
    <h3 class="related-title">Related Posts</h3>
    <div class="related-grid">
        {% for related in related_posts %}
        <article class="related-card">
            <h4 class="related-post-title">
                <a href="/posts/{{ related.slug }}">{{ related.title }}</a>
            </h4>
            <time class="related-date" datetime="{{ related.date }}">
                {{ related.date | date(format="%b %d, %Y") }}
            </time>
        </article>
        {% endfor %}
    </div>
    {% endif %}
</aside>
{% endblock %}

{% block extra_scripts %}
<script>
    // Add smooth scrolling for anchor links within posts
    document.addEventListener('DOMContentLoaded', function() {
        const links = document.querySelectorAll('a[href^="#"]');
        links.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add copy button to code blocks
        const codeBlocks = document.querySelectorAll('pre code');
        codeBlocks.forEach(block => {
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'Copy';
            button.addEventListener('click', function() {
                navigator.clipboard.writeText(block.textContent).then(() => {
                    button.textContent = 'Copied!';
                    setTimeout(() => {
                        button.textContent = 'Copy';
                    }, 2000);
                });
            });
            block.parentNode.insertBefore(button, block.nextSibling);
        });
    });
</script>
{% endblock %}
